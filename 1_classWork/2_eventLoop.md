## ๐ ะงัะพ ัะฐะบะพะต Event Loop ะฟัะพัััะผะธ ัะปะพะฒะฐะผะธ

**JavaScript ัะฐะฑะพัะฐะตั ะฒ ะพะดะฝะพะผ ะฟะพัะพะบะต.** ะญัะพ ะทะฝะฐัะธั, ััะพ ะพะฝ ะผะพะถะตั ะดะตะปะฐัั **ัะพะปัะบะพ ะพะดะฝั ะฒะตัั ะฒ ะบะพะฝะบัะตัะฝัะน ะผะพะผะตะฝั ะฒัะตะผะตะฝะธ** โ ะฝะฐะฟัะธะผะตั, ะฒัะฟะพะปะฝััั ัะธะบะป, ัะปััะฐัั ะบะปะธะบ ะธะปะธ ััะธัะฐัั ัะธัะปะฐ.

ะะพโฆ ัะพะณะดะฐ ะบะฐะบ ะพะฝ "ะพะดะฝะพะฒัะตะผะตะฝะฝะพ":

- ะถะดัั ะพัะฒะตัะฐ ั ัะตัะฒะตัะฐ (fetch),

- ะฐะฝะธะผะฐัะธั ะดะตะปะฐะตั,

- ะธ ะฝะต ะทะฐะฒะธัะฐะตั?

**ะัะฒะตั: Event Loop.** ะญัะพ ะผะตัะฐะฝะธะทะผ, ะบะพัะพััะน **ัะฟัะฐะฒะปัะตั ะพัะตัะตะดัั ะทะฐะดะฐั** ะธ ะดะฐัั JavaScript ะฒะพะทะผะพะถะฝะพััั ะฒัะฟะพะปะฝััั ะฐัะธะฝััะพะฝะฝัะต ะดะตะนััะฒะธั, ะฝะต ะฑะปะพะบะธััั ะพัะฝะพะฒะฝะพะน ะฟะพัะพะบ.

---

## ๐ง ะัะฝะพะฒะฝัะต ะฟะพะฝััะธั

|ะขะตัะผะธะฝ|ะงัะพ ััะพ|
|-|-|
|Call Stack|ะกัะตะบ ะฒัะทะพะฒะพะฒ. ะะพะด, ะบะพัะพััะน ะธัะฟะพะปะฝัะตััั ะฟััะผะพ ัะตะนัะฐั|
|Web APIs|ะะฝะตัะฝะธะต "ัะปัะถะฑั" ะฑัะฐัะทะตัะฐ (setTimeout, fetch ะธ ั.ะฟ.)|
|Callback Queue|ะัะตัะตะดั ััะฝะบัะธะน, ะพะถะธะดะฐััะธั ะฒัะฟะพะปะฝะตะฝะธั|
|Event Loop|ะะตัะฐะฝะธะทะผ, ะบะพัะพััะน ัะปะตะดะธั: ยซะัััะพ ะปะธ ะฒ ััะตะบะต?ยป|

---

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั (ะฟะพ ัะฐะณะฐะผ)

ะัะตะดััะฐะฒั, ััะพ JS ะฟะพะปััะธะป ัะฐะบะพะน ะบะพะด:

```JavaScript
console.log('1');

setTimeout(() => {
  console.log('2');
}, 0);

console.log('3');
```


### ะงัะพ ะฟัะพะธะทะพะนะดัั:

1. `console.log('1')` โ ะฟะพะฟะฐะป ะฒ ััะตะบ, ะฒัะฒะตะป `1`, ัััะป ะธะท ััะตะบะฐ.

2. `setTimeout(...)` โ ััะพะดะธั ะฒ Web API, ะฑัะฐัะทะตั ััะฐะฒะธั ัะฐะนะผะตั (0 ะผั).

3. `console.log('3')` โ ะฒ ััะตะบ, ะฒัะฒะพะดะธั `3`, ััะตะบ ัะฝะพะฒะฐ ะฟััั.

4. ะขะฐะนะผะตั 0 ะผั ะทะฐะบะพะฝัะธะปัั โ callback (`console.log('2')`) ะบะปะฐะดัััั ะฒ **Callback Queue**.

5. **Event Loop** ะทะฐะผะตัะฐะตั, ััะพ ััะตะบ ะฟััั โ ะฑะตััั ะทะฐะดะฐัั ะธะท ะพัะตัะตะดะธ โ `console.log('2')` ะฟะพะฟะฐะดะฐะตั ะฒ ััะตะบ ะธ ะฒัะฟะพะปะฝัะตััั.

โ ะัะพะณ ะฒ ะบะพะฝัะพะปะธ:

```JavaScript
1  
3  
2
```


---

## ๐งช ะะธะทัะฐะปัะฝัะน ะฟัะธะผะตั (ะผะพะถะตัั ะฒััะฐะฒะธัั ะฒ `main.js`):

```JavaScript
console.log("Start");

setTimeout(() => {
  console.log("Timeout");
}, 0);

Promise.resolve().then(() => {
  console.log("Promise");
});

console.log("End");
```


๐ **ะะตะทัะปััะฐั:**

```JavaScript
Start
End
Promise
Timeout
```


๐ ะะพัะตะผั?

- `Promise.then()` ะธะดัั ะฒ **ะผะธะบัะพะทะฐะดะฐัะธ (microtasks queue)** โ ะพะฝะฐ **ะฒัะฟะพะปะฝัะตััั ัะฐะฝััะต**.

- `setTimeout` โ ะฒ **ะผะฐะบัะพะทะฐะดะฐัะธ (callback queue)**.

---

## ๐ ะงัะพ ะฝัะถะฝะพ ะทะฐะฟะพะผะฝะธัั:

- Call Stack โ ัะตะบััะธะต ะทะฐะดะฐัะธ.

- Event Loop โ ะพัะบะตัััะฐัะพั, ัะปะตะดะธั ะทะฐ ะพัะตัะตะดัะผะธ.

- Microtask queue (ะฝะฐะฟัะธะผะตั, `.then`) ะฒะฐะถะฝะตะต, ัะตะผ macrotask (ะฝะฐะฟัะธะผะตั, `setTimeout`).

- ะะฐะถะต `setTimeout(fn, 0)` โ ะฝะต ะฒัะฟะพะปะฝัะตััั ะผะณะฝะพะฒะตะฝะฝะพ.

---

## ๐ง ะฅะพัะตัั ะฟะพััะตะฝะธัะพะฒะฐัััั?

ะะพั ะฟัะพััะฐั, ะฝะพ ะฟะพะปะตะทะฝะฐั ะทะฐะดะฐัะฐ ะฝะฐ **Event Loop**, ะธะดะตะฐะปัะฝะพ ะฟะพะดัะพะดััะฐั ะดะปั ะดะถัะฝะฐ:

---

### ๐ ะะฐะดะฐัะฐ: **ะะพััะดะพะบ ะฒัะฒะพะดะฐ**

```JavaScript
console.log("A");

setTimeout(() => {
  console.log("B");
}, 0);

Promise.resolve().then(() => {
  console.log("C");
});

console.log("D");
```


---

### ๐ง ะขะฒะพั ัะตะปั:

6. **ะัะตะดัะบะฐะทะฐัั**, ะฒ ะบะฐะบะพะผ ะฟะพััะดะบะต ะฒัะฒะตะดัััั ะฑัะบะฒั ะฒ ะบะพะฝัะพะปั.

7. **ะะฑัััะฝะธัั**, ะฟะพัะตะผั ะธะผะตะฝะฝะพ ัะฐะบ ะฟัะพะธััะพะดะธั โ ะพะฟะธัะฐััั ะฝะฐ ะทะฝะฐะฝะธั ะพะฑ:

  - Call Stack

  - Microtasks (Promises)

  - Macrotasks (setTimeout)

  - Event Loop

---

### โ ะะถะธะดะฐะตะผัะต ะพัะฒะตัั:

- ะงัะพ ะฒัะฒะตะดะตััั ะฒ ะบะพะฝัะพะปะธ?

- ะะพัะตะผั `C` ะฟะพัะฒะปัะตััั ัะฐะฝััะต `B`, ะดะฐะถะต ะตัะปะธ `setTimeout(..., 0)`?

---

ะัะปะธ ัะตัะธัั โ ะผะพะถะตัั ัะบะธะฝััั ััะดะฐ ัะฒะพะธ ะผััะปะธ, ะธ ั ะฟะพะผะพะณั ะฟัะพะฒะตัะธัั ะธะปะธ ะพะฑัััะฝะธัั ะฟะพะดัะพะฑะฝะตะต. ะะพัะพะฒ? ๐

ะัะปะธัะฝัะน ัะฐะทะฑะพั! ะขั ะดะฒะธะถะตัััั ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ะฝะฐะฟัะฐะฒะปะตะฝะธะธ ๐ช ะะฐะฒะฐะน ะฟะพะดััะพะถะธะผ ะธ ะฝะตะผะฝะพะณะพ ััะพัะฝะธะผ, ััะพะฑั ะทะฐะบัะตะฟะธัั ะฟะพะฝะธะผะฐะฝะธะต:

---

## โ ะงัะพ ะฟัะพะธััะพะดะธั ะฟะพัะฐะณะพะฒะพ:

ะะพั ัะฒะพะน ะบะพะด ะตัั ัะฐะท:

```JavaScript
console.log("A");

setTimeout(() => {
  console.log("B");
}, 0);

Promise.resolve().then(() => {
  console.log("C");
});

console.log("D");
```


---

### ๐ฉ 1. ะกะฝะฐัะฐะปะฐ ะทะฐะฟััะบะฐะตััั **Call Stack**:

```JavaScript
console.log("A"); // ััะฐะทั ะฒัะฒะพะดะธััั => A
```


---

### ๐ฉ 2. ะะฐัะตะผ:

```JavaScript
setTimeout(() => { console.log("B"); }, 0);
```


- `setTimeout` ััะพะดะธั ะฒ **Web APIs**

- ะะพัะปะต ะทะฐะดะตัะถะบะธ (0 ะผั) **callback ััะฐะฒะธััั ะฒ ะพัะตัะตะดั Macrotasks**

---

### ๐ฉ 3. ะะพัะพะผ:

```JavaScript
Promise.resolve().then(() => { console.log("C"); });
```


- `then(...)` ััะพะดะธั ะฒ ะพัะตัะตะดั **Microtasks** โ ะพะฝะธ ะฟัะธะพัะธัะตัะฝะตะต!

---

### ๐ฉ 4. ะะฐะปะตะต:

```JavaScript
console.log("D"); // ััะฐะทั ะฒัะฒะพะดะธััั => D
```


---

### ๐ Event Loop ะฝะฐัะธะฝะฐะตั ัะฐะฑะพัั:

- โ **ะกะฝะฐัะฐะปะฐ** ะฒัะฟะพะปะฝััััั **Microtasks** (ะฒัะต, ััะพ ะฒ `.then()` ะธ `queueMicrotask`)
๐ ะฒัะฒะพะดะธััั `C`

- โ ะะพัะพะผ ะฑะตััััั ะฟะตัะฒะฐั **Macrotask** ะธะท ะพัะตัะตะดะธ (callback ะพั `setTimeout`)
๐ ะฒัะฒะพะดะธััั `B`

---

## ๐ฏ ะัะพะณะพะฒัะน ะฟะพััะดะพะบ ะฒ ะบะพะฝัะพะปะธ:

```JavaScript
A
D
C
B
```


---

## ๐ ะัะพะณะพ:

- `console.log("A")` โ ััะฐะทั

- `setTimeout(..., 0)` โ **Macrotask**

- `Promise.resolve().then(...)` โ **Microtask**

- `console.log("D")` โ ััะฐะทั

- Event loop โ ัะฝะฐัะฐะปะฐ Microtask โ ะฟะพัะพะผ Macrotask

---

ะัะปะธ ัะพัะตัั โ ะผะพะณั ะดะฐัั ะตัั ะพะดะฝั ะฟะพัะพะถัั ะทะฐะดะฐัะบั ั `setTimeout`, `Promise`, `async/await`, ััะพะฑั ะทะฐะบัะตะฟะธัั. ะฅะพัะตัั?

